<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Lfin Tree View Example</title>
</head>
<body>
<main>
 <ul id="treeRoot"></ul>
</main>

<script type="module">
import { View, ListView } from '/lib/flatout.js';

var treeData = {
  name: "Root",
  children: [
    {
      name: "Taro",
      children: [
        {
          name: "Sanshiro"
        },
        {
          name: "Hanako"
        }
      ]
    }, {
      name: "Jiro",
      children: [
        {
          name: "Jiro jr."
        }
      ]
    },
    {
      name: "Saburo"
    }
  ]
};

class TreeNodeView extends View {
  html(data) {
    return `\
    <li>
      <p data-id="name">${data.name}</p>
      <ul data-id="children"></ul>
      <form data-id="addChildForm">
        <input type="text" name="cname"><input type="submit" value="Add child">
      </form>
    </li>`
  }

  load(views, evts) {
    const childrenView = views.children = new ListView(TreeNodeView);

    evts.name_click = () => {
      if (childrenView.el.style.display === "none") {
        childrenView.el.style.display = "block";
      } else {
        childrenView.el.style.display = "none";
      }
    }

    evts.addChildForm_submit = (form, evt) => {
      childrenView.addItem({ name: form.cname.value, children: [] });
      form.cname.value = null;
    }
  }
}

class MainView extends View {
  load(views, evts) {
    views.list = new ListView('treeRoot', TreeNodeView, { data: [treeData] });
  }
}

const main = new MainView(document.querySelector('main'));
main._loadFinish()
</script>
</body>
</html>
